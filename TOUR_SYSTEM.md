# üéØ –°–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–æ–≤ HanJaemi

## üìã **–û–±–∑–æ—Ä**

–°–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ Supabase –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üîß **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
```sql
-- –ü–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç—É—Ä–æ–≤
is_new_user BOOLEAN DEFAULT true           -- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Ç—É—Ä–∞
lesson_tour_completed BOOLEAN DEFAULT false -- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—É—Ä–∞ —É—Ä–æ–∫–∞
```

### **API Endpoints**
- `GET /api/users/profile` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/users/mark-not-new` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Ç—É—Ä–∞
- `POST /api/users/mark-lesson-tour-completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—É—Ä–∞ —É—Ä–æ–∫–∞

## üéØ **–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**

### **–≠—Ç–∞–ø 1: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/study`**
```typescript
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ä —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
if (profile.is_new_user) {
  startFullOnboarding();
}
```

### **–≠—Ç–∞–ø 2: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Ä–æ–∫–∞ `/study/[id]`**
```typescript
// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—É—Ä —É—Ä–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ —Ç—É—Ä–∞
if (!profile.is_new_user && !profile.lesson_tour_completed) {
  continueLessonTour();
}
```

## üìä **–°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

### **–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**
1. `/study` ‚Üí —Ç—É—Ä –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚úÖ
2. –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç—É—Ä ‚Üí `is_new_user = false`
3. `/study/1` ‚Üí —Ç—É—Ä —É—Ä–æ–∫–∞ ‚úÖ
4. –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç—É—Ä ‚Üí `lesson_tour_completed = true`

### **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**
1. `/study` ‚Üí —Ç—É—Ä –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ‚úÖ
2. `/study/1` ‚Üí —Ç—É—Ä –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ‚úÖ

## üîç **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

**–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:**
- `"New user detected on study page, starting tour"`
- `"Existing user on study page, skipping tour"`

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Ä–æ–∫–∞:**
- `"User completed main tour but not lesson tour, starting lesson tour"`
- `"New user on lesson page, skipping lesson tour (should complete main tour first)"`
- `"User already completed lesson tour, skipping"`

## üöÄ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**

- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –≤ Supabase, –Ω–µ –≤ localStorage
- ‚úÖ **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚úÖ **–õ–æ–≥–∏—á–Ω–æ—Å—Ç—å** - —Ç—É—Ä —É—Ä–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≥–ª–∞–≤–Ω–æ–≥–æ —Ç—É—Ä–∞
- ‚úÖ **–û–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Ç—É—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

## üìÅ **–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã**

- `components/tour-trigger.tsx` - –∑–∞–ø—É—Å–∫ —Ç—É—Ä–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- `app/study/[id]/page.tsx` - –ª–æ–≥–∏–∫–∞ —Ç—É—Ä–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É—Ä–æ–∫–∞
- `components/context/tour-context.tsx` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏
- `lib/services/serverUserService.ts` - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ —Ç—É—Ä–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
